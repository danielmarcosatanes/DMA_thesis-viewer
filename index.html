<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMA Thesis | 3D Mechanistic Viewer</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="JSmol.min.js"></script>
    <!-- Fuentes coherentes con tu web personal -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body>

    <button id="sidebar-toggle" class="mobile-toggle" onclick="toggleSidebar()">â˜° Menu</button>

    <div id="main-container">
        <nav id="sidebar">
            <header>
                <h1>Daniel Marcos</h1>
                <p class="tagline">Mechanistic Explorer</p>
                <input type="text" id="sidebar-search" placeholder="Search intermediate..." onkeyup="searchMenu()">
            </header>

            <div id="menu">
                <a href="#" id="home-link" class="active" onclick="showHomePage(); setActiveLink('home-link')">Home Overview</a>
                <!-- El Ã¡rbol se genera aquÃ­ mediante JS -->
            </div>

            <footer>
                <a href="https://daniel-marcosatanes.github.io/" target="_blank">Back to Portfolio</a>
            </footer>
        </nav>

        <main id="content">
            <div id="dynamic-content" class="container-pro">
                <!-- UI inyectada dinÃ¡micamente -->
            </div>
        </main>
    </div>

<script>
    // --- MAPEO DE CARPETAS (Exactamente igual a tu Ã¡rbol de archivos) ---
    const structureData = {
        "Structures section 7.1": [
            "4-m-bipy-OA-TS-Ir(R-H)(Bpin)3.log", "4-p-bipy-OA-TS-Ir(R-H)(Bpin)3.log",
            "5-m-phen-OA-TS-Ir(R-H)(Bpin)3.log", "5-OR-bipy-OA-TS-Ir(R-H)(Bpin)3.log",
            "5-p-phen-OA-TS-Ir(R-H)(Bpin)3.log", "bipy-OA-TS-Ir(R-H)(Bpin)3.log"
        ],
        "Structures section 7.2": {
            "3-CF3-Bipy": { "Meta": ["3-CF3-Bipy_TS_m-31.log"], "Ortho": ["3-CF3-Bipy_TS_o-2.log"], "Para": ["3-CF3-Bipy_TS_p-1.log"] },
            "4-CF3-Bipy": { "Meta": ["4-CF3-Bipy_TS_m-8.log"], "Ortho": ["4-CF3-Bipy_TS_o-3.log"], "Para": ["4-CF3-Bipy_TS_p-3.log"] },
            "5-CF3-Bipy": { "Meta": ["5-CF3-Bipy_TS_m-5.log"], "Ortho": ["5-CF3-Bipy_TSOA_o-1.log"], "Para": ["5-CF3-Bipy_TSOA_p-1.log"] },
            "Bipy": { "Meta": ["Bipy_TS_m-3.log"], "Ortho": ["Bipy_TS_o-1.log"], "Para": ["Bipy_TS_p-1.log"] }
        },
        "Structures section 7.3": {
            "Borylation of 44a": {
                "5-CF3-Bipy": {
                    "Ir(Bpin)": ["L27-Ir(Bpin).log"], "Ir(Bpin)3": ["L27-Ir(Bpin)3.log"], "Ir(Bpin)5": ["L27-Ir(Bpin)5.log"], "Ir(H)(Bpin)2": ["L27-Ir(H)(Bpin)2.log"],
                    "Isom-H": {
                        "Ïƒ-isoH-(R-Bpin)Ir(Bpin)2(H)": ["L27-Ïƒ-isoH-(R-Bpin)Ir(Bpin)2(H).log"],
                        "isoH-Ir(Bpin)3(R)(H)": ["L27-isoH-Ir(Bpin)3(R)(H).log"],
                        "isomH-TS-Ir(Bpin)3(R)(H)": ["L27-isomH-TS-Ir(Bpin)3(R)(H).log"],
                        "RE-TS-isoH-Ir(Bpin)3(R)(H)": ["L27-RE-TS-isoH-Ir(Bpin)3(R)(H).log"]
                    },
                    "Isom-S": {
                        "Ïƒ-isoS-(R-Bpin)Ir(Bpin)2(H)": ["L27-Ïƒ-isoS-(R-Bpin)Ir(Bpin)2(H).log"],
                        "isomS-TS-Ir(Bpin)3(R)(H)": ["L27-isomS-TS-Ir(Bpin)3(R)(H).log"],
                        "isoS-Ir(Bpin)3(R)(H)": ["L27-isoS-Ir(Bpin)3(R)(H).log"],
                        "RE-TS-isoS-Ir(Bpin)3(R)(H)": ["L27-RE-TS-isoS-Ir(Bpin)3(R)(H).log"]
                    },
                    "OA": {
                        "Ïƒ-(R-H)Ir(Bpin)3": ["L27-Ïƒ-(R-H)Ir(Bpin)3.log"],
                        "Ir(Bpin)3(R)(H)": ["L27-Ir(Bpin)3(R)(H).log"],
                        "OA-TS-Ir(R-H)(Bpin)3": ["L27-OA-TS-Ir(R-H)(Bpin)3.log"]
                    },
                    "RE": {
                        "Ïƒ-iso-(R-Bpin)Ir(Bpin)2(H)": ["L27-Ïƒ-iso-(R-Bpin)Ir(Bpin)2(H).log"],
                        "RE-TS-Ir(Bpin)3(R)(H)": ["L27-RE-TS-Ir(Bpin)3(R)(H).log"]
                    }
                },
                "Bipy": {
                    "Ir(Bpin)": ["Bipy-Ir(Bpin).log"], "Ir(Bpin)3": ["Bipy-Ir(Bpin)3.log"], "Ir(Bpin)5": ["Bipy-Ir(Bpin)5.log"], "Ir(H)(Bpin)2": ["Bipy-Ir(H)(Bpin)2.log"],
                    "Isom-H": {
                        "Ïƒ-isoH-(R-Bpin)Ir(Bpin)2(H)": ["Bipy-Ïƒ-isoH-(R-Bpin)Ir(Bpin)2(H).log"],
                        "isoH-Ir(Bpin)3(R)(H)": ["Bipy-isoH-Ir(Bpin)3(R)(H).log"],
                        "isomH-TS-Ir(Bpin)3(R)(H)": ["Bipy-isomH-TS-Ir(Bpin)3(R)(H).log"],
                        "RE-TS-isoH-Ir(Bpin)3(R)(H)": ["Bipy-RE-TS-isoH-Ir(Bpin)3(R)(H).log"]
                    },
                    "Isom-S": {
                        "Ïƒ-isoS-(R-Bpin)Ir(Bpin)2(H)": ["Bipy-Ïƒ-isoS-(R-Bpin)Ir(Bpin)2(H).log"],
                        "isomS-TS-Ir(Bpin)3(R)(H)": ["Bipy-isomS-TS-Ir(Bpin)3(R)(H).log"],
                        "isoS-Ir(Bpin)3(R)(H)": ["Bipy-isoS-Ir(Bpin)3(R)(H).log"],
                        "RE-TS-isoS-Ir(Bpin)3(R)(H)": ["Bipy-RE-TS-isoS-Ir(Bpin)3(R)(H).log"]
                    },
                    "OA": {
                        "Ïƒ-(R-H)Ir(Bpin)3": ["Bipy-Ïƒ-(R-H)Ir(Bpin)3.log"],
                        "Ir(Bpin)3(R)(H)": ["Bipy-Ir(Bpin)3(R)(H).log"],
                        "OA-TS-Ir(R-H)(Bpin)3": ["Bipy-OA-TS-Ir(R-H)(Bpin)3.log"]
                    },
                    "RE": {
                        "Ïƒ-iso-(R-Bpin)Ir(Bpin)2(H)": ["Bipy-Ïƒ-iso-(R-Bpin)Ir(Bpin)2(H).log"],
                        "RE-TS-Ir(Bpin)3(R)(H)": ["Bipy-RE-TS-Ir(Bpin)3(R)(H).log"]
                    }
                },
                "Bis-5-CF3-Bipy": {
                    "Ir(Bpin)": ["L28-Ir(Bpin).log"], "Ir(Bpin)3": ["L28-Ir(Bpin)3.log"], "Ir(Bpin)5": ["L28-Ir(Bpin)5.log"], "Ir(H)(Bpin)2": ["L28-Ir(H)(Bpin)2.log"],
                    "Isom-H": {
                        "Ïƒ-isoH-(R-Bpin)Ir(Bpin)2(H)": ["L28-Ïƒ-isoH-(R-Bpin)Ir(Bpin)2(H).log"],
                        "isoH-Ir(Bpin)3(R)(H)": ["L28-isoH-Ir(Bpin)3(R)(H).log"],
                        "isomH-TS-Ir(Bpin)3(R)(H)": ["L28-isomH-TS-Ir(Bpin)3(R)(H).log"],
                        "RE-TS-isoH-Ir(Bpin)3(R)(H)": ["L28-RE-TS-isoH-Ir(Bpin)3(R)(H).log"]
                    },
                    "OA": {
                        "Ïƒ-(R-H)Ir(Bpin)3": ["L28-Ïƒ-(R-H)Ir(Bpin)3.log"],
                        "Ir(Bpin)3(R)(H)": ["L28-Ir(Bpin)3(R)(H).log"],
                        "OA-TS-Ir(R-H)(Bpin)3": ["L28-OA-TS-Ir(R-H)(Bpin)3.log"]
                    }
                }
            },
            "Borylation of 44c": {
                "5-CF3": {
                    "Isom-H": { "isomH-TS": ["L27-isomH-TS-Ir(Bpin)3(R)(H).log"], "RE-TS-isoH": ["L27-RE-TS-isoH-Ir(Bpin)3(R)(H).log"] },
                    "OA": { "OA-TS": ["L27-OA-TS-Ir(R-H)(Bpin)3.log"] }
                },
                "Bipy": {
                    "Isom-H": { "isomH-TS": ["Bipy-isomH-TS-Ir(Bpin)3(R)(H).log"] },
                    "OA": { "OA-TS": ["Bipy-OA-TS-Ir(R-H)(Bpin)3.log"] }
                }
            },
            "Borylation of 44f": {
                "C-CH3": {
                    "5-CF3-Bipy": { "OA": ["L27-OA-TS-Ir(R-H)(Bpin)3.log"] },
                    "Bipy": { "OA": ["Bipy-OA-TS-Ir(R-H)(Bpin)3.log"] }
                }
            },
            "Borylation of 44u": {
                "Bis-5-CF3-Bipy": { "OA": ["L28-OA-TS-Ir(R-H)(Bpin)3.log"] }
            },
            "Rollover": {
                "Bipy": {
                    "Hemilabile-TS": ["Bipy-Hemilabile-TS.log"],
                    "Ir(LX)Bpin2": ["Bipy-Ir(LX)Bpin2.log"],
                    "OA-TS": ["Bipy-OA-TS-Ir(LX)(R-H)(Bpin)3.log"]
                },
                "Bis-5-CF3-Bipy": {
                    "OA-TS": ["L28-OA-TS-Ir(LX)(R-H)(Bpin)3.log"]
                }
            }
        }
    };

    let myJmol = null;

     // --- GENERADOR DE MENÃš RECURSIVO ---
     function createSidebarMenu(data, parent, currentPath = "molecules/Structures", level = 0) {
         Object.keys(data).forEach((key) => {
             const fullPath = `${currentPath}/${key}`;
             const safeId = "ID_" + fullPath.replace(/[^a-zA-Z0-9]/g, '_');
             const displayName = beautify(key);

             if (Array.isArray(data[key])) {
                 // Caso: Lista de archivos directa
                 const folderLink = document.createElement("a");
                 folderLink.textContent = (level === 0 ? "â— " : "") + displayName;
                 folderLink.className = (level === 0) ? "folder-link level-0" : "folder-link";
                 folderLink.onclick = () => toggleSection(safeId);
                 parent.appendChild(folderLink);

                 const subDiv = document.createElement("div");
                 subDiv.id = safeId;
                 subDiv.className = "submenu";
                 subDiv.style.display = "none";

                 data[key].forEach((file) => {
                     const moleculeName = file.replace('.log', '');
                     const fileLink = document.createElement("a");
                     fileLink.textContent = moleculeName;
                     fileLink.className = "file-link";
                     fileLink.onclick = (e) => {
                         e.stopPropagation();
                         loadMolecule(`${fullPath}/${file}`, moleculeName);
                     };
                     subDiv.appendChild(fileLink);
                 });
                 parent.appendChild(subDiv);
             } else {
                 // Caso: Carpeta con subcarpetas
                 const folderLink = document.createElement("a");
                 folderLink.textContent = (level === 0 ? "â— " : "") + displayName;
                 folderLink.className = (level === 0) ? "folder-link level-0" : "folder-link";
                 folderLink.onclick = () => toggleSection(safeId);
                 parent.appendChild(folderLink);

                 const subfolderDiv = document.createElement("div");
                 subfolderDiv.id = safeId;
                 subfolderDiv.className = "submenu";
                 subfolderDiv.style.display = "none";
                 createSidebarMenu(data[key], subfolderDiv, fullPath, level + 1);
                 parent.appendChild(subfolderDiv);
             }
         });
     }

     function toggleSection(id) {
         const s = document.getElementById(id);
         if (s) s.style.display = (s.style.display === "none" || s.style.display === "") ? "block" : "none";
     }

     // --- CARGA DE JSMOL (Fix rutas con espacios) ---
     function loadMolecule(filePath, moleculeName) {
         const content = document.getElementById("dynamic-content");
         const encodedPath = encodeURI(filePath);

         content.innerHTML = `
             <div class="molecule-card">
                 <header class="mol-header">
                     <h2>${moleculeName}</h2>
                 </header>

                 <div id="jsmolContainer" class="jsmol-box"></div>

                 <div class="toolbar">
                     <div class="tool-group">
                         <button class="btn-outline" onclick="Jmol.script(myJmol, 'reset')">Reset View</button>
                         <button class="btn-outline" onclick="Jmol.script(myJmol, 'zoom +20')">Zoom +</button>
                         <button class="btn-outline" onclick="Jmol.script(myJmol, 'zoom -20')">Zoom -</button>
                     </div>
                     <div class="tool-group checkboxes">
                         <label><input type="checkbox" onchange="Jmol.script(myJmol, this.checked ? 'spin on' : 'spin off')"> Spin</label>
                         <label><input type="checkbox" onchange="Jmol.script(myJmol, this.checked ? 'vibration on' : 'vibration off')"> Vibration</label>
                     </div>
                     <button class="btn-solid" onclick="Jmol.script(myJmol, 'write PNGJ \\'${moleculeName}.png\\'')">ðŸ“¸ Capture</button>
                 </div>

                 <div class="sci-comm-info">
                     <div class="pro-tip">PRO TIP: Use the vibration mode to see the reaction coordinate transition!</div>
                     <h3>About this intermediate</h3>
                     <p>Computational stationary point optimized at the DFT level. Explore the coordination sphere by rotating the model.</p>
                 </div>
             </div>
         `;

         const Info = { width: "100%", height: 500, j2sPath: "j2s", color: "#FFFFFF", use: "HTML5", disableInitialConsole: true };
         myJmol = Jmol.getApplet("myJmol", Info);
         document.getElementById("jsmolContainer").innerHTML = Jmol.getAppletHtml(myJmol);

         Jmol.script(myJmol, `load "${encodedPath}"; model 2; set ambientPercent 25; set specularPower 100; set specularPercent 22; set antialiasDisplay on;`);

         setActiveLink(moleculeName);
         if (window.innerWidth <= 768) toggleSidebar();
     }

     function showHomePage() {
         const content = document.getElementById("dynamic-content");
         content.innerHTML = `
             <div class="home-hero">
                 <h1>Interactive Mechanistic Viewer</h1>
                 <p class="lead">A 3D digital companion to my research on <strong>Iridium-catalyzed borylations</strong>.</p>

                 <div class="oracle-card">
                     <span class="oracle-label">Gaussian Quote Oracle</span>
                     <p id="quote-display">Loading computational wisdom...</p>
                     <button class="btn-ghost" onclick="loadRandomQuote()">Generate Tip</button>
                 </div>

                 <div class="feature-grid">
                     <div class="feature-item">
                         <h3>Dynamic Analysis</h3>
                         <p>Chemical mechanisms aren't 2D. Rotate, zoom and explore interactions that define regioselectivity.</p>
                     </div>
                     <div class="feature-item">
                         <h3>DFT Precision</h3>
                         <p>All models are rendered directly from Gaussian output files used in my PhD thesis.</p>
                     </div>
                 </div>
             </div>
         `;
         loadRandomQuote();
     }

     function loadRandomQuote() {
         fetch('g16_quotes.txt').then(r => r.text()).then(t => {
             const q = t.split('\n\n').filter(x => x.trim() !== "");
             document.getElementById("quote-display").textContent = q[Math.floor(Math.random() * q.length)];
         }).catch(() => {});
     }

     function searchMenu() {
         const q = document.getElementById("sidebar-search").value.toLowerCase();
         document.querySelectorAll("#menu a.file-link").forEach(a => {
             a.style.display = a.textContent.toLowerCase().includes(q) ? "block" : "none";
         });
     }

     function setActiveLink(name) {
         document.querySelectorAll('#menu a').forEach(a => {
             a.classList.remove('active');
             if (a.textContent === name) a.classList.add('active');
         });
     }

     window.onload = () => {
         createSidebarMenu(structureData, document.getElementById("menu"));
         showHomePage();
     };

     function toggleSidebar() {
         document.getElementById('sidebar').classList.toggle('show');
     }
 </script>
 </body>
 </html>
