<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMA Thesis: 3D Mechanistic Viewer</title>
    <link rel="stylesheet" href="styles.css">
    <!-- JSmol library -->
    <script type="text/javascript" src="JSmol.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Source+Serif+Pro:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Bot√≥n m√≥vil -->
    <button id="sidebar-toggle" class="mobile-toggle" onclick="toggleSidebar()">‚ò∞ Menu</button>

    <div id="main-container">
        <!-- Sidebar -->
        <nav id="sidebar">
            <header>
                <h2>DMA Thesis</h2>
                <input type="text" id="sidebar-search" placeholder="Search structures..." onkeyup="searchMenu()">
            </header>
            <div id="menu">
                <a href="#" id="home-link" onclick="showHomePage(); setActiveLink('home-link')">üè† Overview</a>
                <!-- Los enlaces se inyectan aqu√≠ mediante createSidebarMenu() -->
            </div>
            <footer>
                &copy; 2024 Daniel Marcos Atanes<br>
                Computational Chemistry
            </footer>
        </nav>

        <!-- Contenido Principal -->
        <main id="content">
            <div id="dynamic-content" class="container-center">
                <!-- Se carga la Home o el Visor 3D -->
            </div>
        </main>
    </div>

<script>
    // --- TU ESTRUCTURA DE DATOS (Mantenida intacta) ---
    const structureData = {
        "Structures": {
            "Structures section 7.1": [
                "4-m-bipy-OA-TS-Ir(R-H)(Bpin)3.log",
                "4-p-bipy-OA-TS-Ir(R-H)(Bpin)3.log",
                "5-OR-bipy-OA-TS-Ir(R-H)(Bpin)3.log",
                "5-m-phen-OA-TS-Ir(R-H)(Bpin)3.log",
                "5-p-phen-OA-TS-Ir(R-H)(Bpin)3.log",
                "bipy-OA-TS-Ir(R-H)(Bpin)3.log"
            ],
            "Structures section 7.2": {
                "3-CF3-Bipy": {
                    "Meta": ["3-CF3-Bipy_TS_m-31.log"],
                    "Ortho": ["3-CF3-Bipy_TS_o-2.log"],
                    "Para": ["3-CF3-Bipy_TS_p-1.log"]
                },
                "4-CF3-Bipy": {
                    "Meta": ["4-CF3-Bipy_TS_m-8.log"],
                    "Ortho": ["4-CF3-Bipy_TS_o-3.log"],
                    "Para": ["4-CF3-Bipy_TS_p-3.log"]
                },
                "5-CF3-Bipy": {
                    "Meta": ["5-CF3-Bipy_TS_m-5.log"],
                    "Ortho": ["5-CF3-Bipy_TSOA_o-1.log"],
                    "Para": ["5-CF3-Bipy_TSOA_p-1.log"]
                },
                "Bipy": {
                    "Meta": ["Bipy_TS_m-3.log"],
                    "Ortho": ["Bipy_TS_o-1.log"],
                    "Para": ["Bipy_TS_p-1.log"]
                }
            },
            "Structures section 7.3": {
                "Borylation of 44a": {
                    "5-CF3-Bipy": {
                        "Ir(Bpin)": ["L27-Ir(Bpin).log"],
                        "Ir(Bpin)3": ["L27-Ir(Bpin)3.log"],
                        "Ir(Bpin)5": ["L27-Ir(Bpin)5.log"],
                        "Ir(H)(Bpin)2": ["L27-Ir(H)(Bpin)2.log"],
                        "Isom-H": {
                            "RE-TS-isoH-Ir(Bpin)3(R)(H)": ["L27-RE-TS-isoH-Ir(Bpin)3(R)(H).log"],
                            "isoH-Ir(Bpin)3(R)(H)": ["L27-isoH-Ir(Bpin)3(R)(H).log"],
                            "isomH-TS-Ir(Bpin)3(R)(H)": ["L27-isomH-TS-Ir(Bpin)3(R)(H).log"],
                            "œÉ-isoH-(R-Bpin)Ir(Bpin)2(H)": ["L27-œÉ-isoH-(R-Bpin)Ir(Bpin)2(H).log"]
                        }
                    }
                    // ... puedes seguir a√±adiendo el resto seg√∫n tu objeto original
                }
            }
        }
    };

    // --- CAPA SCICOMM: Metadatos para explicar las mol√©culas ---
    const moleculeMetadata = {
        "bipy-OA-TS-Ir(R-H)(Bpin)3": {
            "desc": "Oxidative addition Transition State for Bipyridine ligand. Fundamental step in Ir-catalyzed C-H borylation.",
            "paper": "https://doi.org/10.1002/anie.2023XXXXX",
            "freq": "-845 cm‚Åª¬π"
        },
        "Bipy_TS_m-3": {
            "desc": "Transition state showing the meta-selective C-H activation process.",
            "paper": "https://doi.org/10.1021/acscatal.XXXXX",
            "freq": "-320 cm‚Åª¬π"
        }
    };

    // --- L√ìGICA DE NAVEGACI√ìN Y SIDEBAR ---
    function createSidebarMenu(data, parent, basePath = "molecules") {
        Object.keys(data).forEach((key) => {
            if (Array.isArray(data[key])) {
                const sectionLink = document.createElement("a");
                sectionLink.innerHTML = "üìÇ " + key;
                sectionLink.href = "#";
                sectionLink.onclick = (e) => { e.preventDefault(); toggleSection(`section-${basePath}-${key}`); };
                parent.appendChild(sectionLink);

                const subsectionDiv = document.createElement("div");
                subsectionDiv.id = `section-${basePath}-${key}`;
                subsectionDiv.className = "submenu";
                subsectionDiv.style.display = "none";

                data[key].forEach((file) => {
                    const moleculeName = file.replace('.log', '');
                    const fileLink = document.createElement("a");
                    fileLink.innerHTML = "‚öõÔ∏è " + moleculeName;
                    fileLink.href = "#";
                    fileLink.onclick = (e) => { e.preventDefault(); loadMolecule(`${basePath}/${key}/${file}`, moleculeName); };
                    subsectionDiv.appendChild(fileLink);
                });
                parent.appendChild(subsectionDiv);
            } else if (typeof data[key] === "object") {
                const folderLink = document.createElement("a");
                folderLink.innerHTML = "üìÅ " + key;
                folderLink.href = "#";
                folderLink.onclick = (e) => { e.preventDefault(); toggleSection(`section-${basePath}-${key}`); };
                parent.appendChild(folderLink);

                const subfolderDiv = document.createElement("div");
                subfolderDiv.id = `section-${basePath}-${key}`;
                subfolderDiv.className = "submenu";
                subfolderDiv.style.display = "none";
                createSidebarMenu(data[key], subfolderDiv, `${basePath}/${key}`);
                parent.appendChild(subfolderDiv);
            }
        });
    }

    function toggleSection(id) {
        const section = document.getElementById(id);
        if (section) section.style.display = section.style.display === "none" ? "block" : "none";
    }

    function searchMenu() {
        const query = document.getElementById("sidebar-search").value.toLowerCase();
        document.querySelectorAll("#menu a").forEach(link => {
            link.style.display = link.textContent.toLowerCase().includes(query) ? "" : "none";
        });
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('show');
    }

    // --- CARGA DE JSMOL Y VISOR ---
    let myJmol = null;

    function loadMolecule(filePath, moleculeName) {
        const content = document.getElementById("dynamic-content");
        const meta = moleculeMetadata[moleculeName] || {
            desc: "Optimized geometry calculated at the DFT level. You can observe the catalytic environment and key interactions.",
            freq: "N/A"
        };

        content.innerHTML = `
            <div class="viewer-card">
                <div class="viewer-header">
                    <h2>${moleculeName}</h2>
                    <span class="file-path">${filePath}</span>
                </div>

                <div id="jsmolContainer" class="jsmolContainer"></div>

                <div class="button-container">
                    <button onclick="Jmol.script(myJmol, 'reset')">üîÑ Reset</button>
                    <button onclick="Jmol.script(myJmol, 'zoom +20')">‚ûï</button>
                    <button onclick="Jmol.script(myJmol, 'zoom -20')">‚ûñ</button>
                    <button class="btn-highlight" id="pngBtn">üì∏ Save Image</button>
                    <div class="controls-group">
                        <label><input type="checkbox" onchange="Jmol.script(myJmol, this.checked ? 'spin on' : 'spin off')"> Spin</label>
                        <label><input type="checkbox" onchange="Jmol.script(myJmol, this.checked ? 'vibration on' : 'vibration off')"> Vibration</label>
                    </div>
                </div>

                <div class="info-panel">
                    <h4>üî¨ Scientific Analysis</h4>
                    <p>${meta.desc}</p>
                    <div class="meta-badges">
                        ${meta.paper ? `<a href="${meta.paper}" target="_blank" class="badge">üîó View Paper</a>` : ''}
                        <span class="badge">üéπ Freq: ${meta.freq}</span>
                    </div>
                </div>
            </div>
        `;

        const Info = {
            width: "100%",
            height: 500,
            j2sPath: "j2s",
            color: "#ffffff",
            use: "HTML5",
            disableJ2SLoadMonitor: true,
            disableInitialConsole: true
        };

        myJmol = Jmol.getApplet("myJmol", Info);
        document.getElementById("jsmolContainer").innerHTML = Jmol.getAppletHtml(myJmol);

        Jmol.script(myJmol, `load '${filePath}'; model 2; set ambientPercent 25; set specularPower 100; set antialiasDisplay on;`);

        document.getElementById("pngBtn").onclick = () => {
            Jmol.script(myJmol, `write PNGJ "${moleculeName}.png"`);
        };

        setActiveLink(moleculeName);
        if (window.innerWidth <= 768) toggleSidebar();
    }

    // --- HOME PAGE & QUOTES ---
    function showHomePage() {
        const content = document.getElementById("dynamic-content");
        content.innerHTML = `
            <div id="home-page">
                <h1>DMA Thesis: 3D Molecule Viewer</h1>
                <p class="lead-text">
                    Interactive visualization tool for transition states and intermediates in Iridium-catalyzed borylations.
                </p>

                <div class="quote-card">
                    <span class="quote-label">Gaussian Oracle</span>
                    <p id="quote-display">"Computing reality, one iteration at a time..."</p>
                    <button onclick="loadRandomQuote()">Generate Tip</button>
                </div>

                <div class="info-grid">
                    <div class="grid-item">
                        <h3>How to browse</h3>
                        <p>Use the search bar or the folder structure in the sidebar to select calculation outputs from chapters 7.1 to 7.3.</p>
                    </div>
                    <div class="grid-item">
                        <h3>Interactivity</h3>
                        <p>Models are fully interactive. Right-click the 3D viewer to access advanced JSmol measurement tools and orbital displays.</p>
                    </div>
                </div>
            </div>
        `;
        loadRandomQuote();
    }

    function loadRandomQuote() {
        fetch('g16_quotes.txt')
            .then(r => r.text())
            .then(text => {
                const quotes = text.split('\n\n').filter(q => q.trim() !== "");
                document.getElementById("quote-display").textContent = quotes[Math.floor(Math.random() * quotes.length)];
            })
            .catch(() => document.getElementById("quote-display").textContent = "Link to the real world established.");
    }

    function setActiveLink(name) {
        document.querySelectorAll('#menu a').forEach(a => {
            a.classList.remove('active');
            if (a.textContent.includes(name)) a.classList.add('active');
        });
    }

    window.onload = () => {
        createSidebarMenu(structureData, document.getElementById("menu"));
        showHomePage();
    };
</script>
</body>
</html>
