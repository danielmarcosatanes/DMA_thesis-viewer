<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMA Thesis: 3D Molecule Viewer</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="JSmol.min.js"></script>
</head>
<body>
    <div id="main-container">
        <!-- Mobile Sidebar Toggle Button -->
        <button id="sidebar-toggle" class="mobile-toggle" aria-label="Toggle sidebar" onclick="toggleSidebar()">☰</button>

        <!-- Desktop Sidebar Toggle Button -->
        <button id="collapse-btn" class="collapse-btn" aria-label="Collapse Sidebar">☰</button>

        <!-- Sidebar -->
        <div id="sidebar">
            <header>
                <h2>DMA Thesis</h2>
                <input type="text" id="sidebar-search" placeholder="Search..." onkeyup="searchMenu()">
            </header>
            <div id="menu"></div>
            <footer>
                2024 DMA Thesis Viewer. All rights reserved.
            </footer>
        </div>

        <!-- Main Content -->
        <div id="content">
            <div id="home-page">
                <h1>DMA Thesis: 3D Molecule Viewer</h1>
                <p>Welcome to the DMA Thesis 3D Molecule Visualizer. Use the menu to explore molecules.</p>
            </div>
        </div>
    </div>

  <script>
    const structureData = {
        "Structures section 7.1": [
            "4-m-bipy-OA-TS-Ir(R-H)(Bpin)3.log",
            "4-p-bipy-OA-TS-Ir(R-H)(Bpin)3.log",
            "5-OR-bipy-OA-TS-Ir(R-H)(Bpin)3.log"
        ],
        "Structures section 7.3": {
            "44a": {
                "5-CF3-Bipy": {
                    "Ir(Bpin)": ["L27-Ir(Bpin).log"],
                    "Ir(Bpin)3": ["L27-Ir(Bpin)3.log"]
                }
            }
        }
    };

    function createSidebarMenu(data, parent, basePath = "molecules") {
        Object.keys(data).forEach((key) => {
            if (Array.isArray(data[key])) {
                const sectionLink = document.createElement("a");
                sectionLink.textContent = key;
                sectionLink.href = "#";
                sectionLink.onclick = () => toggleSection(`section-${key}`);
                parent.appendChild(sectionLink);

                const subsectionDiv = document.createElement("div");
                subsectionDiv.id = `section-${key}`;
                subsectionDiv.style.display = "none";

                data[key].forEach((file) => {
                    const fileLink = document.createElement("a");
                    fileLink.textContent = file;
                    fileLink.href = "#";
                    fileLink.onclick = () => loadMolecule(`${basePath}/${key}/${file}`);
                    subsectionDiv.appendChild(fileLink);
                });

                parent.appendChild(subsectionDiv);
            } else {
                const folderLink = document.createElement("a");
                folderLink.textContent = key;
                folderLink.href = "#";
                folderLink.onclick = () => toggleSection(`section-${key}`);
                parent.appendChild(folderLink);

                const subfolderDiv = document.createElement("div");
                subfolderDiv.id = `section-${key}`;
                subfolderDiv.style.display = "none";

                createSidebarMenu(data[key], subfolderDiv, `${basePath}/${key}`);
                parent.appendChild(subfolderDiv);
            }
        });
    }

    function searchMenu() {
        const query = document.getElementById("sidebar-search").value.toLowerCase();
        const links = document.querySelectorAll("#menu a"); // All sidebar links
        const sections = document.querySelectorAll(".sidebar-section"); // Top-level sections
        const subsections = document.querySelectorAll(".subsections"); // Subsections

        let hasResults = false;

        // Initially collapse all sections and subsections
        sections.forEach(section => (section.style.display = "none"));
        subsections.forEach(subsection => (subsection.style.display = "none"));

        // Search for matching links
        links.forEach(link => {
            const linkText = link.textContent.toLowerCase();
            if (linkText.includes(query)) {
                link.style.display = ""; // Show matching links
                hasResults = true;

                // Ensure the parent section and subsection are visible
                const parentSubsection = link.closest(".subsections");
                const parentSection = link.closest(".sidebar-section");

                if (parentSubsection) {
                    parentSubsection.style.display = "block";
                }
                if (parentSection) {
                    parentSection.style.display = "block";
                }
            } else {
                link.style.display = "none"; // Hide non-matching links
            }
        });

        // Optional: Show a message if no results are found
        if (!hasResults) {
            console.log("No results found.");
        }
    }

    function toggleSection(id) {
        const section = document.getElementById(id);
        if (section) {
            section.style.display = section.style.display === "none" ? "block" : "none";
        }
    }

    function loadMolecule(filePath) {
        console.log(`Loading molecule from: ${filePath}`);
        const content = document.getElementById("content");
        content.innerHTML = `
            <h3>${filePath}</h3>
            <div id="jsmolContainer" class="jsmolContainer"></div>
            <div class="button-container">
                <button id="resetBtn">Reset</button>
                <button id="zoomInBtn">Zoom In</button>
                <button id="zoomOutBtn">Zoom Out</button>
                <label>
                    <input type="checkbox" id="spinCheckbox"> Spin
                </label>
                <label>
                    <input type="checkbox" id="vibrationCheckbox"> imaginary freq.
                </label>
            </div>
        `;

        const Info = {
            width: 700,
            height: 400,
            j2sPath: "j2s",
            color: "#EBEBEB",
            use: "HTML5",
            disableJ2SLoadMonitor: true,
            disableInitialConsole: true
        };
        const applet = Jmol.getApplet("jsmolContainer", Info);
        document.getElementById("jsmolContainer").innerHTML = Jmol.getAppletHtml(applet);
        Jmol.script(applet, `load '${filePath}';`);
        Jmol.script(applet, "model 2");
        Jmol.script(applet, "set ambientPercent 25; set specularPower 100; set specularPercent 22; set specularExponent 4; set cartoonsFancy on; set antialiasDisplay on; set hermiteLevel 20;");

        // Once the molecule is loaded, initialize button functionalities
        addButtonFunctionality(applet);  // Add button and checkbox functionality after applet is ready

    }

    function addButtonFunctionality(applet) {
        // Reset button functionality
        document.getElementById("resetBtn").onclick = function() {
            Jmol.script(applet, "reset");
            console.log("Resetting molecule");
        };

        // Zoom In button functionality
        document.getElementById("zoomInBtn").onclick = function() {
            Jmol.script(applet, "zoom +20");
            console.log("Zooming In");
        };

        // Zoom Out button functionality
        document.getElementById("zoomOutBtn").onclick = function() {
            Jmol.script(applet, "zoom -20");
            console.log("Zooming Out");
        };

        // Spin checkbox functionality
        const spinCheckbox = document.getElementById("spinCheckbox");
        spinCheckbox.addEventListener("change", function() {
            if (spinCheckbox.checked) {
                Jmol.script(applet, "spin on");
                console.log("Spin enabled");
            } else {
                Jmol.script(applet, "spin off");
                console.log("Spin disabled");
            }
        });

        // Event listener for vibration checkbox
        document.getElementById("vibrationCheckbox").addEventListener("change", function (event) {
            if (event.target.checked) {
                Jmol.script(applet, "vibration on");
            } else {
                Jmol.script(applet, "vibration off");
            }
        });
    }

    window.onload = function () {
        const menu = document.getElementById("menu");
        createSidebarMenu(structureData, menu);
    };


    function resizeJmol() {
        const jsmolContainers = document.querySelectorAll('.jsmolContainer');

        jsmolContainers.forEach(container => {
              if (window.innerWidth <= 768) {
                  // Mobile view adjustments
                  container.style.width = `${window.innerWidth}px`; // Full width
                  container.style.height = `${window.innerHeight - 100}px`; // Account for top space (100px for header or nav)
              } else {
                  // Desktop view adjustments
            const containerWidth = window.innerWidth * 0.8; // 80% of window width
            const containerHeight = window.innerHeight * 0.6; // 60% of window height
                  container.style.width = `${containerWidth}px`;
                  container.style.height = `${containerHeight}px`;
              }
            // Keep the square aspect ratio
            container.style.aspectRatio = '1 / 1';
        });
    }

    window.addEventListener('resize', resizeJmol);
    window.addEventListener('load', resizeJmol);

  </script>
  <script>
    const sidebar = document.getElementById('sidebar');
    const content = document.getElementById('content');

    // Toggle the sidebar visibility for mobile
    document.querySelector('.mobile-toggle').addEventListener('click', function() {
        document.getElementById('sidebar').classList.toggle('show');  // Toggle visibility
    });

    // Toggle the sidebar visibility for desktop
    document.querySelector('#collapse-btn').addEventListener('click', function() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('show'); // Toggle visibility for desktop
        sidebar.classList.toggle('collapsed'); // Toggle the collapsed state for desktop
    });
</script>
</body>
</html>
